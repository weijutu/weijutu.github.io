<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/cube_logo_v2.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/cube_logo_v2.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/cube_logo_v2.png">
  <link rel="mask-icon" href="/images/cube_logo_v2.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/yellow/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"weijutu.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.13.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜尋...","empty":"我們無法找到任何有關 ${query} 的搜索結果","hits_time":"${hits} 找到 ${time} 個結果","hits":"找到 ${hits} 個結果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="前面一章是解釋說明什麼是 tidy text 文本格式，並且顯示文本裡面詞頻狀況比例最高的有哪些詞，而這篇文來調查不同的主題，做進一步的挖掘，探討情感分析。也就是說，再看一本書時，除了看哪些單字是用了最多，更多得是需要了解本文在對於請感方面的用詞詞彙做推斷，理解本文內的資料是正面或者是負面的情緒，在本篇的介紹大綱裡面包含如下： 學習內容大綱 sentiments 數據集 使用內部聯接 (inner">
<meta property="og:type" content="blog">
<meta property="og:title" content="R語言文字探勘好好玩 - Ch2_採 Tidy 資料做情感分析 (1)">
<meta property="og:url" content="https://weijutu.github.io/2019/04/19/r/r-textmining-02-ch02-1/index.html">
<meta property="og:site_name" content="丸匠筆記">
<meta property="og:description" content="前面一章是解釋說明什麼是 tidy text 文本格式，並且顯示文本裡面詞頻狀況比例最高的有哪些詞，而這篇文來調查不同的主題，做進一步的挖掘，探討情感分析。也就是說，再看一本書時，除了看哪些單字是用了最多，更多得是需要了解本文在對於請感方面的用詞詞彙做推斷，理解本文內的資料是正面或者是負面的情緒，在本篇的介紹大綱裡面包含如下： 學習內容大綱 sentiments 數據集 使用內部聯接 (inner">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://d33wubrfki0l68.cloudfront.net/2b9380f0e5274e3e31eecb780c8bf467d16995ae/2a4fd/images/tidyflow-ch-2.png">
<meta property="og:image" content="https://www.tidytextmining.com/02-sentiment-analysis_files/figure-html/sentimentplot-1.png">
<meta property="og:image" content="https://www.tidytextmining.com/02-sentiment-analysis_files/figure-html/compareplot-1.png">
<meta property="article:published_time" content="2019-04-19T12:24:00.000Z">
<meta property="article:modified_time" content="2022-09-04T01:16:48.916Z">
<meta property="article:author" content="Helen">
<meta property="article:tag" content="R">
<meta property="article:tag" content="文字探勘">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://d33wubrfki0l68.cloudfront.net/2b9380f0e5274e3e31eecb780c8bf467d16995ae/2a4fd/images/tidyflow-ch-2.png">


<link rel="canonical" href="https://weijutu.github.io/2019/04/19/r/r-textmining-02-ch02-1/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-TW","comments":true,"permalink":"https://weijutu.github.io/2019/04/19/r/r-textmining-02-ch02-1/","path":"2019/04/19/r/r-textmining-02-ch02-1/","title":"R語言文字探勘好好玩 - Ch2_採 Tidy 資料做情感分析 (1)"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>R語言文字探勘好好玩 - Ch2_採 Tidy 資料做情感分析 (1) | 丸匠筆記</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-72890173-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-72890173-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">丸匠筆記</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">a > 1, a ^ n = ∞</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>關於</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>標籤</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分類</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>歸檔</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%B8%E7%BF%92%E5%85%A7%E5%AE%B9%E5%A4%A7%E7%B6%B1"><span class="nav-number">1.</span> <span class="nav-text">學習內容大綱</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sentiments-%E6%95%B8%E6%93%9A%E9%9B%86"><span class="nav-number">2.</span> <span class="nav-text">sentiments 數據集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%85%A7%E9%83%A8%E8%81%AF%E6%8E%A5-inner-join-%E9%80%B2%E8%A1%8C%E6%83%85%E6%84%9F%E5%88%86%E6%9E%90"><span class="nav-number">3.</span> <span class="nav-text">使用內部聯接 (inner_join) 進行情感分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8D%E4%B8%89%E5%80%8B%E6%83%85%E6%84%9F%E5%AD%97%E5%85%B8%E9%80%B2%E8%A1%8C%E6%AF%94%E8%BC%83"><span class="nav-number">4.</span> <span class="nav-text">對三個情感字典進行比較</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%83%E8%80%83"><span class="nav-number">5.</span> <span class="nav-text">參考</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Helen"
      src="/uploads/avatar.png">
  <p class="site-author-name" itemprop="name">Helen</p>
  <div class="site-description" itemprop="description">天天吃番茄，天天有進步</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">80</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">55</span>
        <span class="site-state-item-name">標籤</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/weijutu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;weijutu" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="回到頂端">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://weijutu.github.io/2019/04/19/r/r-textmining-02-ch02-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Helen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="丸匠筆記">
      <meta itemprop="description" content="天天吃番茄，天天有進步">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="R語言文字探勘好好玩 - Ch2_採 Tidy 資料做情感分析 (1) | 丸匠筆記">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        
        <h1 class="post-title" itemprop="name headline">
          R語言文字探勘好好玩 - Ch2_採 Tidy 資料做情感分析 (1)
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2019-04-19 20:24:00" itemprop="dateCreated datePublished" datetime="2019-04-19T20:24:00+08:00">2019-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新於</span>
      <time title="修改時間：2022-09-04 09:16:48" itemprop="dateModified" datetime="2022-09-04T09:16:48+08:00">2022-09-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/R/" itemprop="url" rel="index"><span itemprop="name">R</span></a>
        </span>
    </span>

  
</div>

        </div>

        

      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><a href="http://weijutu.github.io/2019/04/17/r/r-textmining-01-ch01-1/">前面一章</a>是解釋說明什麼是 tidy text 文本格式，並且顯示文本裡面詞頻狀況比例最高的有哪些詞，而這篇文來調查不同的主題，做進一步的挖掘，探討情感分析。也就是說，再看一本書時，除了看哪些單字是用了最多，更多得是需要了解本文在對於請感方面的用詞詞彙做推斷，理解本文內的資料是正面或者是負面的情緒，在本篇的介紹大綱裡面包含如下：</p>
<h2 id="學習內容大綱"><a href="#學習內容大綱" class="headerlink" title="學習內容大綱"></a>學習內容大綱</h2><ol>
<li>sentiments 數據集</li>
<li>使用內部聯接 (inner_join) 進行情感分析</li>
<li>對三個情感字典進行比較</li>
</ol>
<span id="more"></span>

<p><img data-src="https://d33wubrfki0l68.cloudfront.net/2b9380f0e5274e3e31eecb780c8bf467d16995ae/2a4fd/images/tidyflow-ch-2.png"></p>
<p>一樣是透過 tidy 工具的優勢可以很容易的得知本文內的情感情形。</p>
<h2 id="sentiments-數據集"><a href="#sentiments-數據集" class="headerlink" title="sentiments 數據集"></a>sentiments 數據集</h2><p>我們透過 tidytext 套件，就可以直接使用 <code>sentiments</code> 數據集裡面包含了好幾個情感的字典。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>tidytext<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">sentiments</span><br></pre></td></tr></table></figure>

<p>結果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># A tibble: 27,314 x 4</span><br><span class="line">   word        sentiment lexicon score</span><br><span class="line">   &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;   &lt;int&gt;</span><br><span class="line"> 1 abacus      trust     nrc        NA</span><br><span class="line"> 2 abandon     fear      nrc        NA</span><br><span class="line"> 3 abandon     negative  nrc        NA</span><br><span class="line"> 4 abandon     sadness   nrc        NA</span><br><span class="line"> 5 abandoned   anger     nrc        NA</span><br><span class="line"> 6 abandoned   fear      nrc        NA</span><br><span class="line"> 7 abandoned   negative  nrc        NA</span><br></pre></td></tr></table></figure>

<p>這邊有三個通用性質的詞典為：</p>
<ol>
<li><code>AFINN</code>: <a target="_blank" rel="noopener" href="http://www2.imm.dtu.dk/pubdb/views/publication_details.php?id=6010">Finn Årup Nielsen</a></li>
<li><code>bing</code>: <a target="_blank" rel="noopener" href="https://www.cs.uic.edu/~liub/FBS/sentiment-analysis.html">Bing Liu and collaborators</a></li>
<li><code>nrc</code>: <a target="_blank" rel="noopener" href="http://saifmohammad.com/WebPages/NRC-Emotion-Lexicon.htm">Saif Mohammad and Peter Turney</a></li>
</ol>
<p>這三個詞典都是單獨的詞，裡頭包含了很多英語詞，而且也有正面或負面情感的分數。tidytext 提供了 <code>get_sentiments()</code> 函數可以取得特定的詞典，比如 <code>afinn</code> 就輸入</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_sentiments<span class="punctuation">(</span><span class="string">&quot;afinn&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>結果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># A tibble: 2,476 x 2</span><br><span class="line">   word       score</span><br><span class="line">   &lt;chr&gt;      &lt;int&gt;</span><br><span class="line"> 1 abandon       -2</span><br><span class="line"> 2 abandoned     -2</span><br><span class="line"> 3 abandons      -2</span><br><span class="line"> 4 abducted      -2</span><br><span class="line"> 5 abduction     -2</span><br><span class="line"> 6 abductions    -2</span><br><span class="line"> 7 abhor         -3</span><br></pre></td></tr></table></figure>

<p>而 bing 的部分</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_sentiments<span class="punctuation">(</span><span class="string">&quot;bing&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>結果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># A tibble: 6,788 x 2</span><br><span class="line">   word        sentiment</span><br><span class="line">   &lt;chr&gt;       &lt;chr&gt;    </span><br><span class="line"> 1 2-faced     negative </span><br><span class="line"> 2 2-faces     negative </span><br><span class="line"> 3 a+          positive </span><br><span class="line"> 4 abnormal    negative </span><br><span class="line"> 5 abolish     negative </span><br><span class="line"> 6 abominable  negative </span><br><span class="line"> 7 abominably  negative </span><br></pre></td></tr></table></figure>

<p>再來是 nrc 的部分</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_sentiments<span class="punctuation">(</span><span class="string">&quot;nrc&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>結果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># A tibble: 13,901 x 2</span><br><span class="line">   word        sentiment</span><br><span class="line">   &lt;chr&gt;       &lt;chr&gt;    </span><br><span class="line"> 1 abacus      trust    </span><br><span class="line"> 2 abandon     fear     </span><br><span class="line"> 3 abandon     negative </span><br><span class="line"> 4 abandon     sadness  </span><br><span class="line"> 5 abandoned   anger    </span><br><span class="line"> 6 abandoned   fear     </span><br><span class="line"> 7 abandoned   negative </span><br></pre></td></tr></table></figure>

<p>是不是呈現的結果，<code>sentiment</code> 欄位都有所不同呢？ <code>nrc</code> 詞典把詞按照了是&#x2F;否 標註在各個類別當中，比如正面、負面、情緒、期待、開心、悲傷等等。<code>bing</code> 詞典把二元歸於正面和負面的類別而已，也就是 <code>negative</code> 或者 <code>positive</code>。而 <code>AFINN</code> 詞典則是把每個詞分配成 -5~5 分之間的值，負數代表負面情感，正整數代表正面情感。</p>
<h2 id="使用內部聯接-inner-join-進行情感分析"><a href="#使用內部聯接-inner-join-進行情感分析" class="headerlink" title="使用內部聯接 (inner_join) 進行情感分析"></a>使用內部聯接 (inner_join) 進行情感分析</h2><p>我們一樣使用 <code>janeaustenr</code> 套件電子書做範例的介紹，對於 tidy text 的格式，情感分析是可以在內部關聯 (inner join) 方式完成。</p>
<p>好的，可以看看 <code>nrc</code> 詞典中帶點有快樂分數的單字，另外就是設定每一個單詞都是來自於哪一個章節，在這裡使用了 <code>group_by</code> 以及 <code>mutute</code> 來建造這些結果。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">tidy_books <span class="operator">&lt;-</span> austen_books<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  group_by<span class="punctuation">(</span>book<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  <span class="comment"># 查看每一筆序列號</span></span><br><span class="line">  mutate<span class="punctuation">(</span>linenumber <span class="operator">=</span> row_number<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">         <span class="comment"># 只要文章中的第一個字出現了 chapter 那麼就將的提取出來第幾個章節</span></span><br><span class="line">         chapter <span class="operator">=</span> <span class="built_in">cumsum</span><span class="punctuation">(</span>str_detect<span class="punctuation">(</span>text<span class="punctuation">,</span> regex<span class="punctuation">(</span><span class="string">&quot;^chapter [\\divxlc]&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                                                 ignore_case <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  ungroup<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  <span class="comment"># 取得文字上的單詞</span></span><br><span class="line">  unnest_tokens<span class="punctuation">(</span>word<span class="punctuation">,</span> text<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>以下可以看看 Emma 最開心的詞是什麼？，結果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># A tibble: 725,055 x 4</span><br><span class="line">   book                linenumber chapter word       </span><br><span class="line">   &lt;fct&gt;                    &lt;int&gt;   &lt;int&gt; &lt;chr&gt;      </span><br><span class="line"> 1 Sense &amp; Sensibility          1       0 sense      </span><br><span class="line"> 2 Sense &amp; Sensibility          1       0 and        </span><br><span class="line"> 3 Sense &amp; Sensibility          1       0 sensibility</span><br><span class="line"> 4 Sense &amp; Sensibility          3       0 by         </span><br><span class="line"> 5 Sense &amp; Sensibility          3       0 jane       </span><br><span class="line"> 6 Sense &amp; Sensibility          3       0 austen     </span><br><span class="line"> 7 Sense &amp; Sensibility          5       0 1811     </span><br></pre></td></tr></table></figure>

<p>我們從 <code>unnest_tokens()</code> 中列出了 <code>word</code> 的列，另外在情感詞典也有一個是 <code>word</code> 欄位的名稱，因此執行連結方面更容易許多</p>
<p>好的，現在本文呈現也滿整齊整理單詞了，這樣子就可以開始做情感分析。首先是用 <code>nrc</code> 詞典和 filter() 得到 joy 的詞，再用 filter() 得到 Emma 這本書，然後再用 <code>inner_join()</code> 執行情感分析做將詞做聯合起來。最後使用 dplyr 裡的 <code>count()</code> 看看開心的詞有哪些。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nrc_joy &lt;- get_sentiments(&quot;nrc&quot;) %&gt;% </span><br><span class="line">  filter(sentiment == &quot;joy&quot;)</span><br><span class="line"></span><br><span class="line">tidy_books %&gt;%</span><br><span class="line">  filter(book == &quot;Emma&quot;) %&gt;%</span><br><span class="line">  inner_join(nrc_joy) %&gt;%</span><br><span class="line">  count(word, sort = TRUE)</span><br></pre></td></tr></table></figure>

<p>結果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># A tibble: 303 x 2</span><br><span class="line">   word        n</span><br><span class="line">   &lt;chr&gt;   &lt;int&gt;</span><br><span class="line"> 1 good      359</span><br><span class="line"> 2 young     192</span><br><span class="line"> 3 friend    166</span><br><span class="line"> 4 hope      143</span><br><span class="line"> 5 happy     125</span><br><span class="line"> 6 love      117</span><br><span class="line"> 7 deal       92</span><br></pre></td></tr></table></figure>

<p>在結果呈現裡面可以看到多數的正面詞，比如 <code>good</code>、<code>young</code>、<code>friend</code>。</p>
<p>另外，我們也可以使用 <code>Bing</code> 詞典和 <code>inner_join()</code> 找到每個詞的情感得分，並計算出正面與負面的數量。</p>
<p>我們定義 <code>index</code> 來紀錄敘事的進程，採用這個索引按每 80 行文本做累加。會用 80 行當作基準點是因為太小的段落可能無法得到比較好的情感估值，太大的話會影響到敘事結構。之後用 <code>spread()</code> 在不同的列中得到正面和負面的情感，最後計算情感差距 (正面-負面)。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>tidyr<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">net_sentiment <span class="operator">&lt;-</span> tidy_books <span class="operator">%&gt;%</span></span><br><span class="line">  inner_join<span class="punctuation">(</span>get_sentiments<span class="punctuation">(</span><span class="string">&quot;bing&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  count<span class="punctuation">(</span>book<span class="punctuation">,</span> index <span class="operator">=</span> linenumber <span class="operator">%/%</span> <span class="number">80</span><span class="punctuation">,</span> sentiment<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  spread<span class="punctuation">(</span>sentiment<span class="punctuation">,</span> n<span class="punctuation">,</span> fill <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  mutate<span class="punctuation">(</span>sentiment <span class="operator">=</span> positive <span class="operator">-</span> negative<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>結果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># A tibble: 920 x 5</span><br><span class="line">   book                index negative positive sentiment</span><br><span class="line">   &lt;fct&gt;               &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span><br><span class="line"> 1 Sense &amp; Sensibility     0       16       32        16</span><br><span class="line"> 2 Sense &amp; Sensibility     1       19       53        34</span><br><span class="line"> 3 Sense &amp; Sensibility     2       12       31        19</span><br><span class="line"> 4 Sense &amp; Sensibility     3       15       31        16</span><br><span class="line"> 5 Sense &amp; Sensibility     4       16       34        18</span><br><span class="line"> 6 Sense &amp; Sensibility     5       16       51        35</span><br><span class="line"> 7 Sense &amp; Sensibility     6       24       40        16</span><br></pre></td></tr></table></figure>

<p>好的，接著下來就可以拿這份結果分別繪製出情感分值的圖。在這裏採用 <code>ggplot2</code></p>
<p><img data-src="https://www.tidytextmining.com/02-sentiment-analysis_files/figure-html/sentimentplot-1.png"></p>
<p>在這份圖當中就可以看到故事的發展變化，看起來正向的情緒滿多的。</p>
<h2 id="對三個情感字典進行比較"><a href="#對三個情感字典進行比較" class="headerlink" title="對三個情感字典進行比較"></a>對三個情感字典進行比較</h2><p>前面我們介紹了三個情感詞典，分別是 <code>bing</code>, <code>nrc</code>, <code>AFINN</code> 這三套。本章節就用這三套來介紹，看看情感的變化如何。首先，使用 <code>filter()</code> 選出書上的 <code>傲慢與偏見 Pride &amp; Prejudice</code> 這本書來做講解。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pride_prejudice <span class="operator">&lt;-</span> tidy_books <span class="operator">%&gt;%</span> </span><br><span class="line">  filter<span class="punctuation">(</span>book <span class="operator">==</span> <span class="string">&quot;Pride &amp; Prejudice&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pride_prejudice</span><br></pre></td></tr></table></figure>

<p>顯示結果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># A tibble: 122,204 x 4</span><br><span class="line">   book              linenumber chapter word     </span><br><span class="line">   &lt;fct&gt;                  &lt;int&gt;   &lt;int&gt; &lt;chr&gt;    </span><br><span class="line"> 1 Pride &amp; Prejudice          1       0 pride    </span><br><span class="line"> 2 Pride &amp; Prejudice          1       0 and      </span><br><span class="line"> 3 Pride &amp; Prejudice          1       0 prejudice</span><br><span class="line"> 4 Pride &amp; Prejudice          3       0 by       </span><br><span class="line"> 5 Pride &amp; Prejudice          3       0 jane     </span><br><span class="line"> 6 Pride &amp; Prejudice          3       0 austen   </span><br><span class="line"> 7 Pride &amp; Prejudice          7       1 chapter </span><br></pre></td></tr></table></figure>

<p>跟前面所提到的相同，現在使用 <code>inner_join()</code> 用不同的方法來計算情感，同樣的使用 <code>count</code>, <code>spread()</code>, <code>mutate()</code> 計算出每一段本文的情感狀況</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">afinn <span class="operator">&lt;-</span> pride_prejudice <span class="operator">%&gt;%</span> </span><br><span class="line">  inner_join<span class="punctuation">(</span>get_sentiments<span class="punctuation">(</span><span class="string">&quot;afinn&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">  group_by<span class="punctuation">(</span>index <span class="operator">=</span> linenumber <span class="operator">%/%</span> <span class="number">80</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">  summarise<span class="punctuation">(</span>sentiment <span class="operator">=</span> <span class="built_in">sum</span><span class="punctuation">(</span>score<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">  mutate<span class="punctuation">(</span>method <span class="operator">=</span> <span class="string">&quot;AFINN&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">bing_and_nrc <span class="operator">&lt;-</span> bind_rows<span class="punctuation">(</span>pride_prejudice <span class="operator">%&gt;%</span> </span><br><span class="line">                          <span class="comment"># 採 bing</span></span><br><span class="line">                          inner_join<span class="punctuation">(</span>get_sentiments<span class="punctuation">(</span><span class="string">&quot;bing&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">                          mutate<span class="punctuation">(</span>method <span class="operator">=</span> <span class="string">&quot;Bing et al.&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                        pride_prejudice <span class="operator">%&gt;%</span> </span><br><span class="line">                          <span class="comment"># 採 nrc</span></span><br><span class="line">                          inner_join<span class="punctuation">(</span>get_sentiments<span class="punctuation">(</span><span class="string">&quot;nrc&quot;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">                                       filter<span class="punctuation">(</span>sentiment <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;positive&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                                                               <span class="string">&quot;negative&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">                            mutate<span class="punctuation">(</span>method <span class="operator">=</span> <span class="string">&quot;NRC&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  count<span class="punctuation">(</span>method<span class="punctuation">,</span> index <span class="operator">=</span> linenumber <span class="operator">%/%</span> <span class="number">80</span><span class="punctuation">,</span> sentiment<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  spread<span class="punctuation">(</span>sentiment<span class="punctuation">,</span> n<span class="punctuation">,</span> fill <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  mutate<span class="punctuation">(</span>sentiment <span class="operator">=</span> positive <span class="operator">-</span> negative<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>有了三個比較之後，就用圖示的方式顯示結果</p>
<p><img data-src="https://www.tidytextmining.com/02-sentiment-analysis_files/figure-html/compareplot-1.png"></p>
<p>用了這三個情感詞典給出的結果卻很不相同，但整體看小說的變化事實上有相似的軌跡。在 AFINN 給的最大絕對值，具有高的正直，Bing 標記出連續的正面或是負面。NRC 的話相對於其他結果更高，情緒方面更高，這三者詞典都表達出了透過故事的弧線整體的趨勢走向。</p>
<p>然而，為什麼 NRC 詞典在結果上面有這麼高的情緒比例呢？我們可以看到一下，nrc 與 bing 的正面與負面詞數有多少。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">get_sentiments<span class="punctuation">(</span><span class="string">&quot;nrc&quot;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">filter<span class="punctuation">(</span>sentiment <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;positive&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                        <span class="string">&quot;negative&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">count<span class="punctuation">(</span>sentiment<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>結果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># A tibble: 2 x 2</span><br><span class="line">  sentiment     n</span><br><span class="line">  &lt;chr&gt;     &lt;int&gt;</span><br><span class="line">1 negative   3324</span><br><span class="line">2 positive   2312</span><br></pre></td></tr></table></figure>

<p>那 bing 的部分呢？</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get_sentiments<span class="punctuation">(</span><span class="string">&quot;bing&quot;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">  count<span class="punctuation">(</span>sentiment<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>結果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># A tibble: 2 x 2</span><br><span class="line">  sentiment     n</span><br><span class="line">  &lt;chr&gt;     &lt;int&gt;</span><br><span class="line">1 negative   4782</span><br><span class="line">2 positive   2006</span><br></pre></td></tr></table></figure>

<p>可以從這裡得知，負面詞也都滿多的，尤其是 bing 的負面詞比 nrc 高。所以在做情緒分析時，需要考慮到這三個詞典的差別，看看這個在故事的路徑發展下是否吻合。</p>
<p>情感分析先介紹到這裡</p>
<h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.tidytextmining.com/tidytext.html">Text Mining with R</a></li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>作者： </strong>Helen
  </li>
  <li class="post-copyright-link">
      <strong>文章連結：</strong>
      <a href="https://weijutu.github.io/2019/04/19/r/r-textmining-02-ch02-1/" title="R語言文字探勘好好玩 - Ch2_採 Tidy 資料做情感分析 (1)">https://weijutu.github.io/2019/04/19/r/r-textmining-02-ch02-1/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版權聲明： </strong>本網誌所有文章除特別聲明外，均採用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 許可協議。轉載請註明出處！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/R/" rel="tag"># R</a>
              <a href="/tags/%E6%96%87%E5%AD%97%E6%8E%A2%E5%8B%98/" rel="tag"># 文字探勘</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/04/18/r/r-textmining-01-ch01-2/" rel="prev" title="R語言文字探勘好好玩 - Ch1_Tidy Text 格式 (2)">
                  <i class="fa fa-chevron-left"></i> R語言文字探勘好好玩 - Ch1_Tidy Text 格式 (2)
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019/04/20/r/r-textmining-02-ch02-2/" rel="next" title="R語言文字探勘好好玩 - Ch2_採 Tidy 資料做情感分析 (2)">
                  R語言文字探勘好好玩 - Ch2_採 Tidy 資料做情感分析 (2) <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Helen</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 強力驅動
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  




  <script src="/js/third-party/pace.js"></script>

  





</body>
</html>
